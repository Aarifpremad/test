<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spin Wheel Settings</title>
    <link rel="stylesheet" href="/dashboard.css">
    <link rel="stylesheet" href="/speen.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
</head>
<body>
    <%- include('partials/header') %>
    <div class="main-container">
        <%- include('partials/sidebar', { page: 'spin' }) %>
        <div class="main-content">
            <div class="settings-container">
                <h2>Spin Wheel Settings</h2>

                <div id="prize-list">
                    <!-- Prize items will be dynamically added here -->
                </div>
                <div class="buttons-container">
                    <button class="save-prize-button" onclick="savePrizes()">Save</button>
                    <!-- <button class="add-prize-button" onclick="addPrize()">Add Prize</button> -->
                </div>
            </div>
        </div>
    </div>

    <script>
        const prizeList = document.getElementById('prize-list');

        // Populate prize items with exactly 12 rows from the server data or placeholders
        async function fetchPrizes() {
            const response = await fetch('/api/prizes');
            const prizes = await response.json();

            for (let i = 0; i < 12; i++) {
                const prize = prizes[i] || { title: '', amount: '' }; // Use empty values if no prize data exists
                const prizeItem = document.createElement('div');
                prizeItem.classList.add('prize-item');
                prizeItem.innerHTML = `
                    <input type="text" value="${prize.title}" placeholder="Prize Title">
                    <input type="number" value="${prize.amount}" placeholder="Amount">
                `;
                prizeList.appendChild(prizeItem);
            }
        }

        // Save prizes to the server
        async function savePrizes() {
            const prizes = Array.from(prizeList.children).map(item => {
                return {
                    title: item.querySelector('input[type="text"]').value,
                    amount: parseFloat(item.querySelector('input[type="number"]').value) || 0,
                };
            });

            await fetch('/api/prizes', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(prizes),
            });

            alert('Prizes saved successfully!');
        }

        // Load prizes on page load
        fetchPrizes();
    </script>
</body>
</html>